{"version":3,"sources":["assets\\Script\\dialog\\base_dialog.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GlobalNodeNames } from \"../global_node\";\r\n\r\n\r\nlet ANIM_TAG = 10087;\r\n\r\nlet ScaleSize = 0.5;\r\n\r\nexport enum WindowStyle {\r\n    POPUP,\r\n    NORMAL,\r\n};\r\nconst {ccclass, property} = cc._decorator;\r\n@ccclass\r\nexport abstract class BaseDialog extends cc.Component{\r\n    private m_manager:any = null;\r\n    private m_isInAnim:boolean = false;\r\n    private _tag:any = \"\";\r\n    public get tag(){return this._tag;}\r\n    protected isPfbRaw:boolean = false; //为true时,tag表示路径\r\n\r\n    @property({\r\n        type:cc.Enum(WindowStyle),\r\n        tooltip:\"弹窗样式,POPUP有弹窗动画，NORMAL直接显示\"\r\n    })\r\n    public style:WindowStyle = WindowStyle.POPUP;\r\n    @property({\r\n        tooltip:\"是否点击背后隐藏\"\r\n    })\r\n    public closeByTouchBg = true;\r\n    @property({\r\n        tooltip:\"是否点击返回键隐藏\"\r\n    })\r\n    public closeByTouchBack = true;\r\n    @property(cc.Vec2)\r\n    private offset = cc.v2(0,0);\r\n    @property({\r\n        tooltip:\"黑色半透明遮罩的透明度\"\r\n    })\r\n    public maskOpacity = 128;\r\n    @property({\r\n        tooltip:\"是否全屏\"\r\n    })\r\n    public isFullScreen = false;\r\n\r\n    /**是否正在做弹窗动画，此时点击关闭背景无效 */\r\n    public get isPupuAni(){\r\n        return this.m_isInAnim;\r\n    }\r\n\r\n    /**显示弹窗，为避免死锁，在popuManager里实现 */\r\n    static async create<T>(pfb:string|cc.Prefab,param?:T|any,...args):Promise<BaseDialog>{\r\n        // PopupMgr.getInstance().showWindow(pfb,param)\r\n        return null;\r\n    }\r\n\r\n    ///屏蔽父类的onLoad，事件注册在PopupMgr里处理了\r\n    onLoad(){\r\n        if(this.isFullScreen){\r\n            this.node.width = display.width;\r\n            this.node.height = display.height;\r\n        }else{\r\n            this.node.position = new cc.Vec3(this.offset.x,this.offset.y);\r\n        }\r\n    }\r\n    ///屏蔽父类的onDestroy，事件注销在PopupMgr里处理了\r\n    onDestroy(){\r\n        this.exitView();\r\n        // let config = this.getRawAssetsConfig();\r\n        // if(this.isPfbRaw){\r\n        //     config.prefab = this.tag;\r\n        // }\r\n        // super.onDestroy();\r\n    }\r\n\r\n    /**销毁前调用，有需要在销毁时刻运用节点树的资源时重写这个*/\r\n    onPreDestroy(){\r\n\r\n    }\r\n\r\n    /**获取弹窗出现时的动画 */\r\n    protected getShowAnim():cc.ActionInterval{\r\n        return null;\r\n    }\r\n\r\n    /**获取弹窗关闭时的动画 */\r\n    protected getHideAnim():cc.ActionInterval{\r\n        return null;\r\n    }\r\n\r\n    protected getDftHideAni(){\r\n        let _duartion = 0.3;\r\n        let ani = cc.scaleTo(_duartion,ScaleSize);\r\n        ani = ani.easing(cc.easeBackIn());\r\n        return ani;\r\n    }\r\n    protected getDftShowAni(){\r\n        let _duartion = 0.3;\r\n        this.node.setScale(ScaleSize);\r\n        let ani = cc.sequence(\r\n            cc.scaleTo(0,ScaleSize),\r\n            cc.scaleTo(_duartion,1.0).easing(cc.easeBackOut()),\r\n        );\r\n        return ani;\r\n    }\r\n\r\n    // /**初始化资源，用于加载和释放 */\r\n    // protected getRawAssetsConfig():_RawAssetsConfig{\r\n    //     return {}\r\n    // }\r\n\r\n    initWindow(manager:any,tag,isPfbRaw:boolean,onLoadComplete:Function){\r\n        this.m_manager = manager;\r\n        this.m_isInAnim = false;//是否正在做动画\r\n        this._tag = tag;\r\n        this.isPfbRaw = isPfbRaw;\r\n\r\n        // _loadRawAssets(this.getRawAssetsConfig(),(result)=>{\r\n        //     if(result==\"complete\"){\r\n                onLoadComplete();\r\n        //     }\r\n        // })\r\n    }\r\n\r\n    abstract initView(bundleData?:any,arg1?:any,arg2?:any,arg3?:any);\r\n    abstract exitView(bundleData?:any);\r\n    refreshView(bundleData?:any,arg1?:any,arg2?:any,arg3?:any){}\r\n    \r\n    showWindow(bundleData:any,arg1?:any,arg2?:any,arg3?:any){ \r\n        this.initView(bundleData,arg1,arg2,arg3);\r\n\r\n        //播放动画\r\n        if(this.m_isInAnim || !this.node.active)\r\n            return;\r\n        this.node.setScale(1);\r\n        this.node.stopActionByTag(ANIM_TAG);\r\n        let _action = this.getShowAnim();\r\n        if(_action==null&&this.style==WindowStyle.POPUP){\r\n            _action = this.getDftShowAni();\r\n        }\r\n        if(_action){\r\n            _action.setTag(ANIM_TAG);\r\n            this.m_isInAnim = true;\r\n            let finish = cc.callFunc(function(){\r\n                this.onShowEnd();\r\n            },this);\r\n            this.node.runAction(cc.sequence(_action,finish));\r\n        }else{\r\n            this.onShowEnd();\r\n        }\r\n    }\r\n    onShowEnd(){\r\n        this.m_isInAnim = false;\r\n    }\r\n    dismiss(noAnim:boolean = false,data?:any){\r\n        if(noAnim){\r\n            this.onHideEnd(data);\r\n            return;\r\n        }\r\n        if(this.m_isInAnim)\r\n            return;\r\n        this.node.setScale(1);\r\n        this.node.stopActionByTag(ANIM_TAG);\r\n\r\n        let _action = this.getHideAnim();\r\n        if(_action==null&&this.style==WindowStyle.POPUP){\r\n            _action = this.getDftHideAni();\r\n        }\r\n        if(_action){\r\n            _action.setTag(ANIM_TAG);\r\n            this.m_isInAnim = true;\r\n            let finish = cc.callFunc(function(){\r\n                this.onHideEnd(data);\r\n            },this)\r\n            this.node.runAction(cc.sequence(_action,finish));\r\n        }else{\r\n            this.onHideEnd(data);\r\n        }\r\n    }\r\n\r\n    private _onClosed:Function = null;\r\n    public setOnClosed(func:Function){\r\n        this._onClosed = func;\r\n    }\r\n\r\n    protected onHideEnd(data?:any){\r\n        this.m_isInAnim = false;\r\n        this.node.active = false;\r\n        if(this._onClosed){\r\n            this._onClosed(this);\r\n            this._onClosed = null;\r\n        }\r\n        if(this.m_manager&&this.m_manager.node.active){\r\n            this.m_manager.onHideEnd(this);\r\n        }\r\n    }\r\n\r\n    protected onBtnClose(){\r\n        this.dismiss();\r\n    }\r\n}"]}