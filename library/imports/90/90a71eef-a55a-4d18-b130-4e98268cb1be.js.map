{"version":3,"sources":["assets\\Script\\views\\water.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nconst { ccclass, property, requireComponent, executeInEditMode, disallowMultiple, executionOrder } = cc._decorator;\r\n\r\nexport interface WaterInfo{\r\n    colorId:number,\r\n    color:cc.Color,//颜色\r\n    height:number,//默认情况下，占杯子的高度\r\n}\r\n\r\nconst MAX_ARR_LEN = 6;\r\n\r\nenum PourAction{\r\n    none,\r\n    /**往里加水 */\r\n    in,\r\n    /**向外倒水 */\r\n    out,\r\n}\r\n\r\n@ccclass\r\n@requireComponent(cc.Sprite)\r\n@executeInEditMode\r\n@disallowMultiple\r\n@executionOrder(-100)\r\nexport default class Water extends cc.Component {\r\n    private _action:PourAction = PourAction.none;\r\n    private infos:WaterInfo[] = [];\r\n    /**到这里停止倒水 */\r\n    private stopIdx = -1;\r\n    /**当前是有几层水 */\r\n    private curIdx = 0;\r\n\r\n    /**节点高宽比 */\r\n    private _ratio:number = 1;\r\n    @property(cc.EffectAsset)\r\n    private effect:cc.EffectAsset = null;\r\n    @property private _skewAngle: number = 0;\r\n    @property({ tooltip: CC_DEV && '旋转角度' })\r\n    public get skewAngle() { return this._skewAngle; }\r\n    public set skewAngle(value: number) { \r\n        value = Math.round(value*100)/100;\r\n        // cc.log(\"angle\",value)\r\n        this._skewAngle = value; \r\n        this.updateAngleHeight();\r\n    }\r\n\r\n    private material: cc.Material = null;\r\n\r\n    protected onLoad() {\r\n        let sp = this.node.getComponent(cc.Sprite);\r\n        if (sp.spriteFrame) sp.spriteFrame.getTexture().packable = false;\r\n        // 生成并应用材质\r\n        if(this.effect){\r\n            this.material = cc.Material.create(this.effect);\r\n            sp.setMaterial(0, this.material);\r\n        }\r\n        this.material = sp.getMaterial(0)\r\n        this._ratio = this.node.height/this.node.width;\r\n    }\r\n\r\n    public initInfos(infos:Array<WaterInfo>){\r\n        this.infos = infos;\r\n        this.curIdx = this.infos.length-1;\r\n\r\n        this.initSizeColor();\r\n        this.updateAngleHeight();\r\n    }\r\n\r\n    private addHeight = 0;\r\n    public addInfo(info:WaterInfo){\r\n        this.addHeight = info.height;\r\n        info.height = 0;\r\n        this.infos.push(info);\r\n        this._action = PourAction.in;\r\n        this.curIdx = this.infos.length-1;\r\n\r\n        this.initSizeColor();\r\n    }\r\n\r\n    private onOutStart:Function = null;\r\n    private onOutFinish:Function = null;\r\n    public setPourOutCallback(onOutStart:Function,onOutFinish:Function){\r\n        this.onOutStart = onOutStart;\r\n        this.onOutFinish = onOutFinish;\r\n    }\r\n\r\n    private onInFInish:Function = null;\r\n    public setPourInCallback(onInFInish:Function){\r\n        this.onInFInish = onInFInish;\r\n    }\r\n\r\n    /**\r\n     * 倾斜到哪个角度开始往外边倒水\r\n     */\r\n    public getPourStartAngle(){\r\n        let _height = 0;\r\n        for(let i=0;i<=this.curIdx;i++){\r\n            _height+=this.infos[i].height;\r\n        }\r\n        \r\n        return this.getCriticalAngleWithHeight(_height);\r\n    }\r\n\r\n    /**\r\n     * 倾斜到哪个角度开始停止倒水（当前颜色的水倒完了）\r\n     */\r\n    public getPourEndAngle(){\r\n        this.stopIdx = this.curIdx-this.getTopSameColorNum();\r\n\r\n        let _height = 0;\r\n        for(let i=0;i<=this.stopIdx;i++){\r\n            _height+=this.infos[i].height;\r\n        }\r\n        \r\n        return this.getCriticalAngleWithHeight(_height);\r\n    }\r\n\r\n    /**获取某一高度的水刚好碰到瓶口的临界倾斜角度 */\r\n    private getCriticalAngleWithHeight(_height){\r\n        \r\n        let ret = 0;\r\n        if(_height==0){\r\n            ret = 90;\r\n            return ret;\r\n        }\r\n\r\n        if(_height<0.5){//水的体积小于杯子的一半,先碰到下瓶底\r\n            let tanVal = this._ratio/(_height*2.0);\r\n            ret = Math.atan(tanVal);\r\n        }else{\r\n            let tanVal = 2.0*this._ratio*(1.0-_height); \r\n            ret = Math.atan(tanVal);\r\n        }\r\n        ret = radian2angle(ret);\r\n        return ret;\r\n    }\r\n\r\n    private getTopSameColorNum(){\r\n        let sameColorNum = 0;\r\n        let colorId=null;\r\n        for(let i=this.curIdx;i>=0;i--){\r\n            if(colorId==null){\r\n                sameColorNum++;\r\n                colorId = this.infos[i].colorId;\r\n            }else if(this.infos[i].colorId==colorId){\r\n                sameColorNum++;\r\n            }else{\r\n                break;\r\n            }\r\n        }\r\n        return sameColorNum\r\n    }\r\n\r\n    /**\r\n     * 开始倒水\r\n     * 一直倒水直到不同颜色的水到达瓶口，为当前最大能倾斜的角度\r\n     * @returns 返回值为倾斜角度的绝对值\r\n     */\r\n    public onStartPour(){\r\n        this._action = PourAction.out;\r\n        \r\n        this.stopIdx = this.curIdx-this.getTopSameColorNum();\r\n    }\r\n\r\n    update(){\r\n        if(this._action==PourAction.out){\r\n            this.pourStep();\r\n        }else if(this._action==PourAction.in){\r\n            this.addStep()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 每帧调用，升高水面高度\r\n     */\r\n    addStep(){\r\n        if(this.curIdx<0){\r\n            return;\r\n        }\r\n        let info = this.infos[this.curIdx];\r\n        info.height = Math.round((info.height + 0.005)*1000)/1000;\r\n        // cc.log(\"--------info.height\",info.height)\r\n        if(info.height>=this.addHeight){\r\n            info.height = this.addHeight;\r\n            this._action = PourAction.none;\r\n            if(this.onInFInish){\r\n                this.onInFInish();\r\n                this.onInFInish = null;\r\n            }\r\n        }\r\n\r\n        this.updateAngleHeight();\r\n    }\r\n\r\n    /**\r\n     * * 每帧调用\r\n     * * 降低水面高度 \r\n     */\r\n    pourStep(){\r\n        if(this.curIdx<0){\r\n            this._action = PourAction.none;\r\n            return;\r\n        }\r\n        let _height = 0;\r\n        for(let i=0;i<=this.curIdx;i++){\r\n            _height+=this.infos[i].height;\r\n        }\r\n        let is_top = false;\r\n        let angle = (this.skewAngle%360) * Math.PI / 180.0\r\n        let _t = Math.abs(Math.tan(angle));\r\n        if(_height<0.5){//水的体积小于杯子的一半,先碰到下瓶底\r\n            is_top = _t>(this._ratio)/(_height*2.0);\r\n        }else{\r\n            is_top = _t>2.0*this._ratio*(1.0-_height);\r\n        }\r\n\r\n        let info = this.infos[this.curIdx];\r\n        if(!is_top){//没到瓶口，不往下倒\r\n            if(info.height<0.05){//可能还留了一点点水,要继续倒出去\r\n                \r\n            }else{\r\n                return;\r\n            }\r\n        }\r\n        if(this.onOutStart){\r\n            this.onOutStart();\r\n            this.onOutStart = null;\r\n        }\r\n        \r\n        info.height = Math.round((info.height - 0.005)*1000)/1000;\r\n        if(info.height<0.01){\r\n            info.height = 0;\r\n\r\n            this.infos.pop();\r\n            this.curIdx--;\r\n            // cc.log(\"------this.curIdx\",this.curIdx,this.stopIdx)\r\n            if(this.curIdx==this.stopIdx){\r\n                if(this.onOutFinish){\r\n                    this.onOutFinish();\r\n                    this.onOutFinish = null;\r\n                }\r\n                this._action = PourAction.none;\r\n            }\r\n        }\r\n        // cc.log(\"this.curIdx\",this.curIdx,\"info.height\",info.height.toFixed(2),\"angle\",this.skewAngle.toFixed(2))\r\n        this.updateAngleHeight();\r\n    }\r\n\r\n    private initSizeColor(){\r\n        let _colors = new Float32Array(MAX_ARR_LEN*4);//数组只支持一维数组\r\n        for(let i=0;i<this.infos.length;i++){\r\n            const color = this.infos[i].color;\r\n            _colors[i*4] = color.r/255;\r\n            _colors[i*4+1] = color.g/255;\r\n            _colors[i*4+2] = color.b/255;\r\n            _colors[i*4+3] = 1.0;\r\n        }\r\n        this.material.setProperty('colors', _colors);//数组只支持一维数组\r\n        this.material.setProperty('iResolution', cc.v2(this.node.width,this.node.height));\r\n        this.material.setProperty('waveType', 0);\r\n    }\r\n\r\n    private updateAngleHeight() {\r\n        let _heights = new Float32Array(MAX_ARR_LEN*4);\r\n        for(let i=0;i<this.infos.length;i++){\r\n            _heights[i*4] = this.infos[i].height;\r\n            _heights[i*4+1] = 0;\r\n            _heights[i*4+2] = 0;\r\n            _heights[i*4+3] = 0;\r\n        }\r\n        this.material.setProperty('heights', _heights);\r\n        this.material.setProperty('skewAngle', this._skewAngle);\r\n\r\n        let waveType = 0.0;\r\n        if(this._action==PourAction.in){\r\n            waveType = 1.0;\r\n        }else if(this._action==PourAction.out){\r\n            waveType = 2.0;\r\n        }\r\n        this.material.setProperty('waveType', waveType);\r\n        \r\n        // this.showDebugCenter();\r\n    }\r\n\r\n    private dot:cc.Node = null;\r\n    /**显示水面的中心点，调试shader脚本用 */\r\n    private showDebugCenter(){\r\n        if(CC_EDITOR){\r\n            return;\r\n        }\r\n        if(this.dot==null){\r\n            this.dot = new cc.Node();\r\n            this.dot.parent = this.node;\r\n            let label = this.dot.addComponent(cc.Label);\r\n            label.string = \"·\";\r\n            label.fontSize = 60;\r\n            this.dot.color = cc.Color.RED;\r\n        }\r\n\r\n        let ratio = this.node.height/this.node.width;\r\n        let angle = angle2radian(this.skewAngle);\r\n        let _height = 0;\r\n        for(let i=0;i<=this.curIdx;i++){\r\n            _height+=this.infos[i].height;\r\n        }\r\n        \r\n        let toLeft = Math.sin(angle)>=0.0;\r\n        let center = cc.v2(0.5,1.0-_height);//水面倾斜时，以哪个店为中心店\r\n\r\n        let _t = Math.abs(Math.tan(angle));\r\n        if(_height<=0.5){//水的体积小于杯子的一半,先碰到下瓶底\r\n            let is_bottom = _t>ratio*2.0*_height;//倾斜角度达到瓶底\r\n            if(is_bottom){\r\n                center.x = Math.sqrt((2.0*_height/_t)*ratio)/2.0;\r\n                center.y = 1.0 - Math.sqrt((2.0*_height*_t)/ratio)/2.0;\r\n\r\n                let is_top = _t>(ratio)/(_height*2.0);//倾斜角度达到瓶口\r\n                if(is_top){\r\n                    center.y = 0.5;\r\n                    center.x = _height;\r\n                }\r\n            }\r\n            if(!toLeft){\r\n                center.x = 1.0-center.x;\r\n            }\r\n            if(Math.abs(center.x-0.25)<0.01){\r\n                let i = 0;\r\n            }\r\n            // cc.log(\"aa-------center\",center.x.toFixed(2),center.y.toFixed(2));\r\n        }else{//水比较多，先碰到上瓶底\r\n            let is_top = _t>2.0*ratio*(1.0-_height);\r\n            if(is_top){\r\n                center.x = Math.sqrt(2.0*ratio*(1.0-_height)/_t)/2.0;\r\n                center.y = Math.sqrt(2.0*ratio*(1.0-_height)*_t)/2.0/ratio;\r\n                let is_bottom = _t>ratio/(2.0*(1.0-_height));\r\n                if(is_bottom){\r\n                    center.y = 0.5;\r\n                    center.x = 1.0-_height;\r\n                }\r\n            }else{\r\n            }\r\n\r\n            if(toLeft){\r\n                center.x = 1.0-center.x;\r\n            }\r\n            // cc.log(\"bb-------center\",center.x.toFixed(2),center.y.toFixed(2));\r\n        }\r\n        center.x = center.x - 0.5;\r\n        center.y = -center.y + 0.5;\r\n        let pt = cc.v3(center.x*this.node.width,center.y*this.node.height);\r\n        this.dot.position = pt;\r\n    }\r\n}\r\n\r\nfunction angle2radian(angle:number){\r\n    while(angle>360){\r\n        angle-=360;\r\n    }\r\n    while(angle<-360){\r\n        angle+=360;\r\n    }\r\n    return (angle%360) * Math.PI / 180.0;\r\n}\r\n\r\nfunction radian2angle(radian:number) {\r\n    return radian/Math.PI*180;\r\n}"]}