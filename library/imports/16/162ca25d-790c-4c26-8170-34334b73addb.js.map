{"version":3,"sources":["assets\\Script\\views\\cupMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { PopupMgr } from \"../dialog/dialog_mgr\";\r\nimport { DlgYouWin } from \"../dialog/dlg_youWIn\";\r\nimport Cup, { _CupInfo } from \"./cup\";\r\nimport { WaterFlow } from \"./waterFlow\";\r\n\r\nconst { ccclass, property,executeInEditMode } = cc._decorator;\r\n\r\nconst COOKIE_LEVEL = \"level\"\r\nconst COOKIE_LAST_CFG = \"last_cfg\"\r\nconst COOKIE_ACTION_HISTORY = \"action_history\"\r\n\r\nconst spacesArr = {\r\n    [1] : [0,1],\r\n    [2] : [80,1],\r\n    [3] : [50,1],\r\n    [4] : [40,0.9],\r\n    [5] : [30,0.8],\r\n    [6] : [30,0.65],\r\n    [7] : [20,0.6,60],\r\n    [8] : [10,0.55,80],\r\n}\r\n\r\n@ccclass\r\n@executeInEditMode\r\nexport class CupMgr extends cc.Component{\r\n    @property(cc.JsonAsset)\r\n    private levelCfg:cc.JsonAsset = null;\r\n    @property(cc.Prefab)\r\n    private pfb:cc.Prefab = null;\r\n\r\n    /**当前等级 */\r\n    private _level = 1;\r\n    private curCfg:Array<_CupInfo> = [];\r\n    private _waterFlow:WaterFlow = null;\r\n    onLoad(){\r\n        if(CC_EDITOR){\r\n            return\r\n        }\r\n        this._level = checkint(cc.sys.localStorage.getItem(COOKIE_LEVEL)||1);\r\n        \r\n        let str = cc.sys.localStorage.getItem(COOKIE_LAST_CFG);\r\n        if(str){\r\n            try{\r\n                this.curCfg = JSON.parse(str);\r\n            }catch(e){\r\n                this.initCfg()\r\n            }\r\n        }else{\r\n            this.initCfg()\r\n        }\r\n        str = cc.sys.localStorage.getItem(COOKIE_ACTION_HISTORY);\r\n        if(str){\r\n            try{\r\n                this._actions = JSON.parse(str);\r\n            }catch(e){\r\n\r\n            }\r\n        }\r\n        this.createCups();\r\n\r\n        let _node = new cc.Node();\r\n        _node.parent = this.node;\r\n        \r\n        this._waterFlow = _node.addComponent(WaterFlow);\r\n    }\r\n\r\n    private initCfg(){\r\n        this.curCfg = [];\r\n        let cfgArr:Array<number> = this.levelCfg.json[this._level-1];//每一关的数据，都是数组，每四个数字代表一杯水\r\n        let acc = 0;\r\n        while(acc<cfgArr.length){\r\n            let info = {\r\n                colorIds:[cfgArr[acc],cfgArr[acc+1]||0,cfgArr[acc+2]||0,cfgArr[acc+3]||0]\r\n            }\r\n            this.curCfg.push(info);\r\n            acc+=4;\r\n        }\r\n    }\r\n\r\n    @property private _debugLevel: number = 0;\r\n    @property({ tooltip: CC_DEV && '调试关卡' })\r\n    public get debugLevel() { return this._debugLevel; }\r\n    public set debugLevel(value: number) { \r\n        this._debugLevel = value;\r\n        this._level = value;\r\n        this.nextLevel()\r\n    }\r\n    \r\n    private _cups:Array<Cup> = [];\r\n    private layout_v:cc.Layout = null;\r\n    private async createCups(){\r\n        if(this.layout_v){\r\n            this.layout_v.node.destroyAllChildren();\r\n        }\r\n        this._cups = [];\r\n        this.selected = null;\r\n        this._actions = [];\r\n        // await wait(1);\r\n\r\n        let arr = this.curCfg;\r\n        const len = this.curCfg.length;\r\n        if(len==0){\r\n            return;\r\n        }\r\n        for(let i=0;i<len;i++){\r\n            let info = arr[i];\r\n\r\n            let _node = cc.instantiate(this.pfb);\r\n            _node.parent = this.node;\r\n            let _cup = _node.getComponent(Cup)\r\n            _cup.setCupInfo(info,this.onClickCup.bind(this));\r\n            this._cups.push(_cup)\r\n        }\r\n\r\n        function _createLayout(type:cc.Layout.Type,parent:cc.Node,name?:string) {\r\n            let node = new cc.Node(name);\r\n            node.parent = parent;\r\n            let layout = node.addComponent(cc.Layout);\r\n            layout.type = type;\r\n            layout.resizeMode = cc.Layout.ResizeMode.CONTAINER;\r\n            return layout\r\n        }\r\n        if(this.layout_v==null){\r\n            this.layout_v = _createLayout(cc.Layout.Type.VERTICAL,this.node,\"layout_v\");\r\n            this.layout_v.node.zIndex = 1;\r\n        }\r\n                \r\n        let cupSize = this._cups[0].node.getContentSize();\r\n        let cupIdxGroups:Array<Array<number>> = [];\r\n        if(len<=4){\r\n            let idGroup:Array<number> = [];\r\n            for(let i=0;i<this._cups.length;i++){\r\n                idGroup.push(i);\r\n            }\r\n            cupIdxGroups.push(idGroup);\r\n        }else if(len<=15){\r\n            let idGroup:Array<number> = [];\r\n            let i=0;\r\n            let middleId = (len)/2;\r\n            for(;i<middleId;i++){\r\n                idGroup.push(i);\r\n            }\r\n            cupIdxGroups.push(idGroup);\r\n            idGroup = [];\r\n            \r\n            for(;i<len;i++){\r\n                idGroup.push(i);\r\n            }\r\n            cupIdxGroups.push(idGroup);\r\n            idGroup = [];\r\n        }\r\n\r\n        let layoutArr:Array<cc.Layout> = [];\r\n        let maxNum = 1;\r\n        for(let i = 0;i<cupIdxGroups.length;i++){\r\n            let node_layout_h = _createLayout(cc.Layout.Type.HORIZONTAL,this.layout_v.node,`layout_h_${i}`);\r\n            node_layout_h.node.height = cupSize.height;\r\n            let idGroup = cupIdxGroups[i];\r\n            for(let j=0;j<idGroup.length;j++){\r\n                let id = idGroup[j];\r\n                this._cups[id].node.parent = node_layout_h.node;\r\n            }\r\n            maxNum = Math.max(maxNum,node_layout_h.node.childrenCount);\r\n            let spaceX = spacesArr[maxNum][0];\r\n            if(spaceX!=node_layout_h.spacingX){\r\n                node_layout_h.spacingX = spaceX;\r\n            }\r\n            layoutArr.push(node_layout_h);\r\n        }\r\n\r\n        this.layout_v.enabled = true;\r\n        this.layout_v.node.scale = spacesArr[maxNum][1];\r\n        this.layout_v.spacingY = spacesArr[maxNum][2]||40;\r\n\r\n        for(let layout of layoutArr){\r\n            layout.updateLayout();\r\n            layout.enabled = false;\r\n        }\r\n        this.layout_v.updateLayout();\r\n        this.layout_v.enabled = false;\r\n        for(let cup of this._cups){\r\n            (cup as any).orignPt = cup.node.position;\r\n        }\r\n    }\r\n\r\n    private selected:Cup = null;\r\n    private onClickCup(cup:Cup){\r\n        if(this.selected){\r\n            if(this.selected==cup){\r\n                this.doSelect(cup,false);\r\n                this.selected = null;\r\n            }else if(this.checkPour(this.selected,cup)){\r\n                this.startPour(this.selected,cup);\r\n            }else{\r\n                this.doSelect(this.selected,false);\r\n                this.selected = null;\r\n            }\r\n        }else{\r\n            this.selected = cup;\r\n            this.doSelect(cup,true);\r\n        }\r\n            \r\n    }\r\n\r\n    /**检查两个杯子是否能倒水 */\r\n    private checkPour(src:Cup,dst:Cup){\r\n        let srcTop = src.getTop();\r\n        let dstTop = dst.getTop();\r\n        if(srcTop.topColorId==0){\r\n            return false;\r\n        }\r\n        if(dstTop.topColorId==0){\r\n            return true;\r\n        }\r\n        return srcTop.topColorNum<=dstTop.emptyNum;\r\n    }\r\n\r\n    /**开始倒水 */\r\n    private startPour(src:Cup,dst:Cup){\r\n        dst.node.zIndex = 0;\r\n        dst.node.parent.zIndex = 0;\r\n        src.node.zIndex = 10;\r\n        src.node.parent.zIndex = 10;\r\n        let srcTop = src.getTop();\r\n        let dstPt = cc.v2(dst.node.position);\r\n        let dstGlobal = dst.node.parent.convertToWorldSpaceAR(dstPt)\r\n        let viewSize = cc.view.getVisibleSize()\r\n        let isRight = dstGlobal.x>viewSize.width*0.5;//标记目标是否在屏幕右侧\r\n        if(Math.abs(dstGlobal.x-viewSize.width*0.5)<2){//目标在中间\r\n            let srcPt = src.node.parent.convertToWorldSpaceAR(cc.v2(src.node.position));\r\n            isRight = srcPt.x<viewSize.width*0.5;\r\n        }\r\n        dstPt.y += 60 + dst.node.height*0.5;\r\n        let offsetX = 0//dst.node.width*0.5-20;\r\n        dstPt.x = dstPt.x + (isRight?-offsetX:offsetX);\r\n\r\n        dstPt = dst.node.parent.convertToWorldSpaceAR(dstPt);\r\n        \r\n        //将瓶口设置为锚点\r\n        src.setPourAnchor(isRight)\r\n        dstPt = src.node.parent.convertToNodeSpaceAR(dstPt);\r\n        // cc.log(\"---------src.x\",src.node.x,dstPt.x)\r\n\r\n        const flow = this._waterFlow;\r\n        flow.setLineScale(this.layout_v.node.scale)\r\n        const onPourStart = ()=>{\r\n            let startPt = src.node.convertToWorldSpaceAR(cc.v2())\r\n            startPt = flow.node.parent.convertToNodeSpaceAR(startPt);\r\n            let endPt = cc.v2(startPt.x,dst.getWaterSurfacePosY());\r\n            endPt = flow.node.parent.convertToNodeSpaceAR(endPt);\r\n            endPt.x = startPt.x\r\n\r\n            flow.strokeColor = new cc.Color().fromHEX(srcTop.colorHex);\r\n            \r\n            flow.playFlowAni(startPt,endPt,0.2,false,()=>{\r\n                dst.startAddWater(srcTop.topColorId,srcTop.topColorNum,(cup:Cup,isFinished:boolean)=>{\r\n                    this.onPourOneFinished(src,dst,srcTop.topColorId,srcTop.topColorNum);\r\n                });\r\n            })\r\n        }\r\n        //倒完水就收回去\r\n        function onPourFinish() {\r\n            let startPt = src.node.convertToWorldSpaceAR(cc.v2())\r\n            startPt = flow.node.parent.convertToNodeSpaceAR(startPt);\r\n\r\n            let endPt = cc.v2(startPt.x,dst.getWaterSurfacePosY(true));\r\n            endPt = flow.node.parent.convertToNodeSpaceAR(endPt);\r\n            endPt.x = startPt.x\r\n            \r\n            flow.playFlowAni(startPt,endPt,0.2,true,()=>{\r\n                flow.clear();\r\n            })\r\n\r\n            src.setNormalAnchor();\r\n\r\n            let pt = (src as any).orignPt;\r\n            let moveBack = cc.tween(src.node)\r\n                .delay(0.7)\r\n                .to(0.5,{x:pt.x,y:pt.y,angle:0},{easing:\"sineOut\"})\r\n                .call(()=>{\r\n                    src.node.zIndex = 0;\r\n                    src.node.parent.zIndex = 0;\r\n                })\r\n            moveBack.start();\r\n        }\r\n        this.selected = null;\r\n\r\n        src.moveToPour(dstPt,isRight,onPourStart.bind(this),onPourFinish.bind(this));\r\n    }\r\n\r\n    private doSelect(cup:Cup,bool:boolean){\r\n        let pt = (cup as any).orignPt;\r\n        let y = pt.y+(bool?cup.node.height*0.2:0);\r\n        cc.tween(cup.node).stop();\r\n        cc.tween(cup.node).to(0.2,{y:y}).start();\r\n    }\r\n\r\n    private _actions:Array<Action> = [];\r\n    /**一次倒水完成（以加水那个杯子水面升到最高为界限） */\r\n    private onPourOneFinished(from:Cup,to:Cup,colorId:number,num:number){\r\n        let fromCupIdx = this._cups.indexOf(from);\r\n        let toCupIdx = this._cups.indexOf(to);\r\n        if(this._actions.length==5){\r\n            this._actions.shift()\r\n        }\r\n        this._actions.push({\r\n            from:fromCupIdx,\r\n            to:toCupIdx,\r\n            colorId:colorId,\r\n            num:num\r\n        })\r\n\r\n        let isAllFinished = this.checkIsAllFinished();\r\n        if(isAllFinished){\r\n            cc.log(\"---------完成了\")\r\n            this._level++;\r\n            cc.sys.localStorage.setItem(COOKIE_LEVEL,this._level);\r\n            \r\n            this.node.emit(\"level_finish\")\r\n        }else{\r\n            this.node.emit(\"do_pour\")\r\n        }\r\n        cc.sys.localStorage.setItem(COOKIE_LAST_CFG,JSON.stringify(this.curCfg));\r\n        cc.sys.localStorage.setItem(COOKIE_ACTION_HISTORY,JSON.stringify(this._actions));\r\n    }\r\n\r\n    public getActionNum(){\r\n        return this._actions.length;\r\n    }\r\n\r\n    /**恢复上一次的操作 */\r\n    public undoAction(){\r\n        let action = this._actions.pop();\r\n        if(action==null){\r\n            return false;\r\n        }\r\n        let {from,to,num,colorId} = action;\r\n        let toCup = this._cups[to];\r\n        let fromCup = this._cups[from];\r\n        if(toCup.isPouring()||fromCup.isPouring()){\r\n            return false;\r\n        }\r\n        toCup.removeTopWaterImmediately(num);\r\n        fromCup.addWaterImmediately(colorId,num);\r\n\r\n        return true;\r\n    }\r\n    \r\n    public nextLevel(){\r\n        this.initCfg();\r\n        this.createCups();\r\n    }\r\n\r\n    public getLevel(){\r\n        return this._level;\r\n    }\r\n\r\n    private checkIsAllFinished(){\r\n        for(let cup of this._cups){\r\n            if(!cup.checkIsFinshed()){\r\n                return false\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\ninterface Action{\r\n    from:number,\r\n    to:number,\r\n    num:number,\r\n    colorId:number,\r\n}\r\n\r\nasync function wait(sec:number) {\r\n    return new Promise(function (resolve,reject) {\r\n        setTimeout(() => {\r\n            resolve(null);\r\n        }, sec*1000);\r\n    })\r\n}\r\n\r\nfunction checkint(val){\r\n    if(val==null){\r\n        return 0;\r\n    }\r\n    let ret = parseInt(val);\r\n    if(ret==NaN){\r\n        ret = 0;\r\n    }\r\n    return ret;\r\n}"]}