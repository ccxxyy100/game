{"version":3,"sources":["assets\\Script\\utils\\screen_adapt.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nconst {ccclass, property,menu,executeInEditMode} = cc._decorator;\r\n\r\nexport enum ScreenFit{\r\n    NO_BORDER,//保证短边能铺满屏幕，长边可能会超出屏幕区域\r\n    SHOW_ALL,//保证长边铺满屏幕，能显示所有内容，可能会有黑边\r\n    EXACT_FIT,//长短边均拉伸铺满屏幕，可能会变形\r\n}\r\n\r\nexport class ScreenAdapter{\r\n    public static get canvasSize():cc.Size{\r\n        let ret = cc.view.getCanvasSize();\r\n        do{\r\n            let canvas_node = cc.Canvas.instance.node;\r\n            if(!canvas_node){break;}\r\n            ret = canvas_node.getContentSize();\r\n        }while(false)\r\n        return ret;\r\n    }\r\n\r\n    public static get leftTop(): cc.Vec2 {\r\n        let size = this.canvasSize;\r\n        return cc.v2(-size.width * 0.5, size.height * 0.5);\r\n    }\r\n\r\n    public static get middleBottom(): cc.Vec2 {\r\n        let size = this.canvasSize;\r\n        let pos =  cc.v2(0, -size.height * 0.5);\r\n        return pos;\r\n    }\r\n\r\n    /**实际分辨率和设计分辨率的比例 */\r\n    public static get screenScale(){\r\n        let visible = this.canvasSize;\r\n        let design = cc.Canvas.instance.designResolution;\r\n        cc.log(`visibleSize : ${visible.toString()} designSize:${design.toString()}`);\r\n        return cc.v2(visible.width / design.width, visible.height / design.height);\r\n    }\r\n\r\n    public static get aspectRatio():number{\r\n        let visible = this.canvasSize;\r\n        let ratio = visible.height/visible.width;\r\n        cc.log(`aspectRatio : ${ratio.toFixed(2)}`);\r\n        return ratio;\r\n    }\r\n\r\n    public static get isHigherScreen(): boolean{\r\n        return this.aspectRatio >= 2.0;\r\n    }\r\n\r\n    ///画布和背景图片，自动适应屏幕尺寸\r\n    public static adaptScreenSize(cvs_node: cc.Node, screenFit: ScreenFit = ScreenFit.NO_BORDER): void {\r\n        if (cvs_node) {\r\n            let canvas = cvs_node.getComponent(cc.Canvas);\r\n            if (canvas != null) {\r\n                let _screenScale = this.screenScale;\r\n                cc.log(\"screenScale : \", _screenScale.x.toFixed(2), _screenScale.y.toFixed(2));\r\n                if (screenFit == ScreenFit.NO_BORDER) {\r\n                    ///比设计分辨率细长(宽高比较小)，则宽度固定，否则高度固定\r\n                    let _fitHeight = false;\r\n                    let _fitWidth = false;\r\n                    if (_screenScale.x < _screenScale.y) {\r\n                        _fitHeight = true;\r\n                    } else if (_screenScale.x > _screenScale.y) {\r\n                        _fitWidth = true;\r\n                    }\r\n                    canvas.fitWidth = _fitWidth;\r\n                    canvas.fitHeight = _fitHeight;\r\n                } else if (screenFit == ScreenFit.SHOW_ALL) {\r\n                    //铺满短的一边\r\n                    canvas.fitWidth = _screenScale.x < _screenScale.y;\r\n                    canvas.fitHeight = !canvas.fitWidth;\r\n                } else {\r\n                    canvas.fitWidth = true;\r\n                    canvas.fitHeight = true;\r\n                }\r\n            } else {\r\n                let _nodeScale = cc.v2(this.canvasSize.width/cvs_node.width,this.canvasSize.height/cvs_node.height);\r\n                cc.log(\"_nodeScale : \", _nodeScale.x.toFixed(2), _nodeScale.y.toFixed(2));\r\n                if (screenFit == ScreenFit.NO_BORDER) {\r\n                    let scale: number = Math.max(_nodeScale.x, _nodeScale.y);\r\n                    cvs_node.setScale(scale);\r\n                } else if (screenFit == ScreenFit.SHOW_ALL) {\r\n                    let scale: number = Math.min(_nodeScale.x, _nodeScale.y);\r\n                    cvs_node.setScale(scale);\r\n                } else {\r\n                    cvs_node.setScale(_nodeScale);\r\n                }\r\n            }\r\n        }else{\r\n            cc.error('adapt screen node is null');\r\n        }\r\n    }\r\n}\r\n\r\n@ccclass\r\n@menu(\"adapt/screen_adapt\")\r\n@executeInEditMode\r\nclass M extends cc.Component {\r\n    public static readonly instance: M = new M();\r\n    \r\n    _screenFit: ScreenFit = ScreenFit.NO_BORDER;\r\n    @property({\r\n        type:cc.Enum(ScreenFit),\r\n        tooltip:`NO_BORDER,//保证短边能铺满屏幕，长边可能会超出屏幕区域\r\n        SHOW_ALL,//保证长边铺满屏幕，能显示所有内容，可能会有黑边\r\n        EXACT_FIT,//长短边均拉伸铺满屏幕，可能会变形\r\n        `,\r\n    })\r\n    set screenFit(val){\r\n        this._screenFit = val;\r\n        ScreenAdapter.adaptScreenSize(this.node,this.screenFit);\r\n    }\r\n    get screenFit(){\r\n        return this._screenFit;\r\n    }\r\n\r\n    onLoad(){\r\n        if(!CC_EDITOR){\r\n            ScreenAdapter.adaptScreenSize(this.node,this.screenFit);\r\n        }\r\n    }\r\n}"]}