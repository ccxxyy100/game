{"version":3,"sources":["assets\\Script\\dialog\\dialog_mgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { getGlobalNode, GlobalNodeNames } from \"../global_node\";\r\nimport { LayerColor } from \"../utils/layer_color\";\r\nimport { BaseDialog, WindowStyle } from \"./base_dialog\";\r\n\r\n\r\nexport interface ShowWindowArgs{\r\n    style?:WindowStyle,//弹窗风格\r\n    maskOpacity?:number,//黑色半透明遮罩的透明度\r\n    \r\n    closeByTouchBg?:boolean,//是否点击背后隐藏\r\n    closeByTouchBack?:boolean,//是否点击返回键隐藏\r\n}\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n\r\nfunction applyWidget(node:cc.Node){\r\n    let widget =  node.getComponent(cc.Widget);\r\n    if(widget==null){\r\n        widget = node.addComponent(cc.Widget);\r\n    }\r\n    widget.bottom = 0;\r\n    widget.top = 0;\r\n    widget.left = 0;\r\n    widget.right = 0;\r\n    widget.isAlignBottom = true;\r\n    widget.isAlignTop = true;\r\n    widget.isAlignLeft = true;\r\n    widget.isAlignRight = true;\r\n\r\n    widget.updateAlignment();\r\n}\r\n\r\nexport class PopupMgr extends cc.Component{\r\n    static EVT_POPO_OPEN_FRIST = \"EVT_POPO_OPEN_FRIST\";\r\n    static EVT_POPO_CLOSE_LAST = \"EVT_POPO_CLOSE_LAST\";\r\n    static getInstance():PopupMgr{\r\n        let _node = getGlobalNode(GlobalNodeNames.PopuMgr);//挂在常驻节点上\r\n        let ret = _node.getComponent(PopupMgr)\r\n        if(ret==null){\r\n            applyWidget(_node);\r\n            ret = _node.addComponent(PopupMgr)\r\n            ret.createMaskNode();\r\n        }\r\n        return ret;\r\n    }\r\n    @property\r\n    m_popups:Array<BaseDialog> = []//存放弹窗\r\n\r\n    onLoad(){\r\n\r\n    }\r\n    onDestroy(){\r\n\r\n    }\r\n\r\n    private maskBg:LayerColor = null;\r\n    ///创建蒙版\r\n    private createMaskNode():LayerColor{\r\n        this.maskBg = new LayerColor(cc.color(0,0,0));\r\n        this.maskBg.opacity = 0;\r\n        this.maskBg.parent = this.node;\r\n        return this.maskBg;\r\n    }\r\n\r\n    //显示弹窗\r\n    async showWindow<T>(param:string|cc.Prefab,bundleData?:T|any,...args):Promise<BaseDialog>{\r\n        return new Promise<BaseDialog>((resolve,reject)=>{\r\n            if(param==null){\r\n                reject();\r\n                return;\r\n            }\r\n            let _prefab:cc.Prefab;\r\n            if(param instanceof cc.Prefab){\r\n                _prefab = param;\r\n            }else if(typeof(param)==\"string\" ){\r\n    \r\n            }\r\n            if(_prefab!=null){\r\n                let popu = this.createWindowByPrefab(_prefab,_prefab.name,false,bundleData,...args);\r\n                resolve(popu);\r\n            }else{\r\n                let path = param as string;\r\n                if(!path){\r\n                    reject();\r\n                    return;\r\n                }\r\n                let popu = PopupMgr.getInstance().getWindowByTag(path);\r\n                if(popu){\r\n                    popu.refreshView(bundleData,...args);\r\n                    popu.node.zIndex++;\r\n                    cc.log(\"========弹窗\",popu.node.name,popu.node.zIndex)\r\n                    resolve(popu);\r\n                    return;\r\n                }\r\n                let url = path;\r\n                _prefab = cc.resources.get(url,cc.Prefab) as cc.Prefab;\r\n                if(_prefab){\r\n                    setTimeout(()=>{\r\n                        let popu = this.createWindowByPrefab(_prefab,path,true,bundleData,...args);\r\n                        resolve(popu);\r\n                    })\r\n                }else{\r\n                    cc.resources.load(url,cc.Prefab,(error,_prefab:cc.Prefab)=>{\r\n                        if(error){\r\n                            cc.error(\"---------弹窗加载错误\",error)\r\n                            reject();\r\n                            return;\r\n                        }\r\n                        cc.log(\"---------------load prefab success\",path)\r\n                        let popu = this.createWindowByPrefab(_prefab,path,true,bundleData,...args);\r\n                        resolve(popu);\r\n                    });\r\n                }\r\n                    \r\n            }\r\n        }); \r\n    }\r\n    //从prefab文件实例化为弹窗节点\r\n    //isPfbRaw,是动态加载的prefab,关闭后释放\r\n    private createWindowByPrefab(_prefab:cc.Prefab,tag:string,isPfbRaw:boolean,bundleData:any,...args):BaseDialog{\r\n        if(!cc.isValid(this)){\r\n            return null;\r\n        }\r\n        let popu = PopupMgr.getInstance().getWindowByTag(tag);\r\n        if(popu){\r\n            popu.refreshView(bundleData,...args);\r\n            return null;\r\n        }\r\n        let node = cc.instantiate(_prefab);\r\n        if(node==null){\r\n            cc.log(\"弹窗预制文件不存在\");\r\n            return null;\r\n        }\r\n        node.setPosition(0,0);\r\n        let popup = node.getComponent(BaseDialog);\r\n        if(!popup){\r\n            cc.log(\"--------error prefab弹窗异常\",tag);\r\n            return null;\r\n        }\r\n        popup.initWindow(this,tag,isPfbRaw,()=>{\r\n            this.realShow(popup,bundleData,...args);\r\n        });\r\n        return popup\r\n    }\r\n\r\n    private _isMaskOn = false;\r\n    ///将实例化好的弹窗添加到节点树\r\n    private realShow(popup:BaseDialog,bundleData:any,...args){\r\n        // if(!this._isMaskOn){\r\n            this.maskBg.off(cc.Node.EventType.TOUCH_START,this.onBgTouch,this);\r\n            this.maskBg.on(cc.Node.EventType.TOUCH_START,this.onBgTouch,this);\r\n            if(popup.maskOpacity){\r\n                let fadetime = popup.style==WindowStyle.POPUP?0.2:0;\r\n                if(cc.director.isPaused()){\r\n                    this.maskBg.opacity = popup.maskOpacity;\r\n                }else{\r\n                    this.maskBg.fadeTo(fadetime,popup.maskOpacity,0);\r\n                }\r\n                \r\n            }\r\n            \r\n            this._isMaskOn = true;\r\n        // }\r\n        let zOrder = 0;\r\n        if(this.m_popups.length==0){\r\n            this.node.emit(PopupMgr.EVT_POPO_OPEN_FRIST);\r\n        }else{\r\n            zOrder = this.m_popups[this.m_popups.length-1].node.zIndex;\r\n        }\r\n        this.maskBg.zIndex = (zOrder)\r\n        this.maskBg.setSiblingIndex(zOrder+1)\r\n        popup.node.zIndex = zOrder+1;\r\n        this.node.addChild(popup.node);\r\n        popup.showWindow(bundleData,...args);\r\n\r\n        this.m_popups.push(popup);\r\n    }\r\n\r\n    onBgTouch(event:cc.Event.EventTouch){\r\n        for(let i=this.m_popups.length-1;i>=0;i--){\r\n            let popup = this.m_popups[i];\r\n            if(cc.isValid(popup.node)&&popup.node.active){\r\n                if(popup.closeByTouchBg&&!popup.isPupuAni){\r\n                    popup.dismiss();\r\n                }\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * 返回true表示不往下传递\r\n     */\r\n    onBack(){\r\n        let ret = false\r\n        if(!cc.isValid(this)||!this.node.active)\r\n            return ret;\r\n        for(let i=this.m_popups.length-1;i>=0;i--){\r\n            do{\r\n                let popup = this.m_popups[i];\r\n                if(!cc.isValid(popup.node))\r\n                    break;\r\n                if(!popup.node.active){\r\n                    break;\r\n                }else if(!popup.closeByTouchBack||popup.isPupuAni){//有弹窗，但是这个弹窗不响应返回键\r\n                    ret = true;\r\n                }else{\r\n                    ret = true;\r\n                    popup.dismiss();\r\n                }\r\n            }while(false)\r\n            if(ret)\r\n                break;\r\n        }\r\n        return ret\r\n    }\r\n    onHideEnd(popup:BaseDialog){\r\n        for(let i = 0;i<this.m_popups.length;i++){\r\n            if(this.m_popups[i]===popup){\r\n                this.m_popups.splice(i,1);\r\n                popup.onPreDestroy();\r\n                popup.node.destroy();\r\n                break\r\n            }\r\n        }\r\n        if(this.m_popups.length==0){\r\n            this.maskBg.zIndex = (0)\r\n        }else{\r\n            let zOrder = this.m_popups[this.m_popups.length-1].node.zIndex-1;\r\n            if(zOrder<0){\r\n                zOrder = 0;\r\n            }\r\n            this.maskBg.zIndex = (zOrder);\r\n            this.m_popups[this.m_popups.length-1].node.zIndex = (zOrder+1)\r\n        }\r\n        \r\n\r\n        if(this.m_popups.length==0){\r\n            if(cc.director.isPaused()){\r\n                this.maskBg.opacity = 0;\r\n            }else{\r\n                this.maskBg.fadeOut(popup.style==WindowStyle.POPUP?0.2:0.1);\r\n            }\r\n            this.maskBg.off(cc.Node.EventType.TOUCH_START,this.onBgTouch,this);\r\n            this.node.emit(PopupMgr.EVT_POPO_CLOSE_LAST);\r\n            this._isMaskOn = false;\r\n        }\r\n    }\r\n    public getVisibleCount():number{\r\n        let num = 0;\r\n        for(let _popup of this.m_popups){\r\n            let node = _popup.node;\r\n            if(cc.isValid(node)&&node.active){\r\n                ++num;\r\n            }\r\n        }\r\n        return num;\r\n    }\r\n    closeWindowByTag(tag:any,noAnim:boolean = true){\r\n        for(let popup of this.m_popups){\r\n            if(cc.isValid(popup.node)&&popup.tag==tag){\r\n                popup.dismiss(noAnim);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    getWindowByTag(tag:any):BaseDialog{\r\n        for(let popup of this.m_popups){\r\n            if(cc.isValid(popup.node)&&popup.tag==tag){\r\n                return popup;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    /**移除所有弹窗 */\r\n    removeAllPopup(){\r\n        while(this.m_popups.length>0){\r\n            let popup = this.m_popups[0];\r\n            popup.dismiss(true);\r\n        }\r\n    }\r\n}\r\n\r\nBaseDialog.create = function<T>(pfb:string|cc.Prefab,param:T|any,...args):Promise<BaseDialog> {\r\n    return PopupMgr.getInstance().showWindow(pfb,param,...args)\r\n}"]}